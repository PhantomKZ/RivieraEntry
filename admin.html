<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
  <title>Riviera Entry — Admin</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <link rel="icon" href="img/favicon.ico" type="image/x-icon">
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
  <div id="app" class="app">
    <main class="app-main app-main-wide">
      <section v-if="!isAuthed" class="card admin-login-card">
        <div class="admin-header">
          <img src="img/logo.png" alt="Riviera Entry Logo" class="admin-logo">
          <h1 class="admin-title">Админ-панель</h1>
        </div>
        <h2 style="margin-top:0;margin-bottom:12px;font-size:16px;text-align:center">Вход</h2>
        <div class="form-group">
          <label>Логин</label>
          <input v-model.trim="login" type="text" autocomplete="username" placeholder="admin">
        </div>
        <div class="form-group">
          <label>Пароль</label>
          <input v-model="password" type="password" autocomplete="current-password" placeholder="••••••••">
        </div>
        <button class="btn btn-primary" @click="doLogin">Войти</button>
        <p class="small muted" style="margin-top:8px">Демодоступ: admin / admin</p>
        <a href="index.html" class="btn btn-back">← Назад</a>
      </section>

      <section v-else class="card">
        <div class="table-header">
          <div class="table-title">
            <img src="img/logo.png" alt="Logo" class="table-title-logo">
            <h2 class="table-title-text">Заявки</h2>
            <span class="role-chip" :class="role==='admin' ? 'admin' : 'viewer'">
              <span class="role-letter">{{ role==='admin' ? 'A' : 'R' }}</span>
              <span class="role-text">{{ role==='admin' ? 'Admin' : 'Reseption' }}</span>
            </span>
          </div>
          <button class="actions-toggle" :aria-expanded="actionsOpen ? 'true' : 'false'" aria-label="Меню" @click="actionsOpen = !actionsOpen">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
          </button>
        </div>
        <div class="actions-panel" :class="{ open: actionsOpen }" style="flex-wrap:wrap">
          <select v-model="range" @change="load" class="range-select">
            <option value="all">За всё время</option>
            <option value="day">За день</option>
            <option value="week">За неделю</option>
            <option value="month">За месяц</option>
            <option value="3months">За 3 месяца</option>
            <option value="6months">За полгода</option>
            <option value="year">За год</option>
          </select>
          <button id="exportBtn" class="btn" @click="exportCSV">Экспорт CSV</button>
          <button id="exportXlsxBtn" class="btn" @click="exportXLSX">Экспорт Excel</button>
          <button class="btn" v-if="hasSelection && role==='admin'" @click="deleteSelected" style="background:#b91c1c;color:#fff">Удалить</button>
          <button class="btn" style="background:#0e1116;border:1px solid var(--border);color:var(--text)" @click="logout">Выйти</button>
        </div>
        <div class="form-group" style="margin-bottom:12px;display:flex;gap:8px">
          <input v-model.trim="q" @input="load" type="search" placeholder="Поиск..." style="flex:1 1 auto">
        </div>
        <div class="table-wrap">
          <table class="data-table">
            <thead>
              <tr>
                <th style="width:48px" v-if="role==='admin'">
                  <input type="checkbox" :checked="allOnPageSelected" @change="toggleSelectAll($event)">
                </th>
                <th class="col-index">№</th>
                <th>Дата и время</th>
                <th>ФИО</th>
                <th>Куда</th>
                <th>От кого</th>
                <th>Цель</th>
                <th>Язык</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="(r, idx) in slice" :key="r.id">
                <td data-label="✓" v-if="role==='admin'">
                  <input type="checkbox" :checked="selectedIds.has(r.id)" @change="toggleRow(r.id, $event)">
                </td>
                <td data-label="№">{{ (page - 1) * pageSize + idx + 1 }}</td>
                <td data-label="Дата и время">{{ formatDate(r.createdAt) }}</td>
                <td data-label="ФИО">{{ r.fullName || '-' }}</td>
                <td data-label="Куда">{{ formatDestination(r.destination, r.lang) || '-' }}</td>
                <td data-label="От кого">{{ r.fromWhom || '-' }}</td>
                <td data-label="Цель">{{ formatPurpose(r.purpose, r.lang) }}</td>
                <td data-label="Язык"><span v-html="formatLang(r.lang)"></span></td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="table-pagination">
          <div class="page-size">
            <label class="small muted">Показывать по</label>
            <select v-model.number="pageSize" class="range-select" style="width:auto">
              <option :value="10">10</option>
              <option :value="20">20</option>
              <option :value="50">50</option>
            </select>
          </div>
          <div class="pager">
            <button class="btn" :disabled="page<=1" @click="page = Math.max(1, page-1)">‹</button>
            <span class="small muted">{{ page }} / {{ pages }}</span>
            <button class="btn" :disabled="page>=pages" @click="page = Math.min(pages, page+1)">›</button>
          </div>
        </div>
      </section>
    </main>
  </div>

  <script type="module" src="src/frontend/adminApp.js"></script>
</body>
</html>

